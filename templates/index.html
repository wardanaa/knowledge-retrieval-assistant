<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Q&A Dokumen PDF / TXT</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="mb-4">Q&A Dokumen (TF-IDF)</h1>

    <!-- Flash message -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, msg in messages %}
          <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-sm">
            {{ msg }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Upload dokumen -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">1. Upload dokumen (PDF / TXT)</h5>
        <form method="POST" enctype="multipart/form-data">
          <div class="mb-3">
            <input type="file" name="file" accept=".pdf,.txt" class="form-control" />
          </div>
          <button type="submit" class="btn btn-primary">Proses Dokumen</button>
        </form>
      </div>
    </div>

    {% if state.document_name %}
      <!-- Info dokumen -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Dokumen Aktif</h5>
          <p><strong>Nama:</strong> {{ state.document_name }}</p>
          <p>
            <strong>Ringkasan preprocessing:</strong>
            {{ state.stats.pages }} halaman,
            {{ state.stats.paragraphs }} paragraf,
            {{ state.stats.chunks }} chunk
          </p>
          <p><strong>Preview teks:</strong></p>
          <pre style="max-height: 200px; overflow-y: auto; white-space: pre-wrap;">{{ state.preview }}</pre>
        </div>
      </div>

      <!-- Form tanya jawab -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">2. Ajukan pertanyaan</h5>
          <form method="POST">
            <div class="mb-3">
              <textarea
                name="question"
                rows="2"
                class="form-control"
                placeholder="Tulis pertanyaan di sini..."
              >{{ question }}</textarea>
            </div>
            <button type="submit" class="btn btn-success">Cari Jawaban</button>
          </form>
        </div>
      </div>

      {% if answers %}
        <!-- Hasil jawaban -->
        <div class="card">
          <div class="card-body">
            <h5 class="card-title mb-3">Hasil Pencarian Jawaban</h5>
            {% for a in answers %}
              <div class="mb-3 p-3 border rounded bg-white">
                <p class="mb-1">
                  <strong>Rank {{ loop.index }}</strong>
                  &mdash; Score: {{ a.score }} &mdash;
                  Halaman: {{ a.pages }}
                </p>
                <p style="white-space: pre-wrap;">{{ a.text }}</p>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
    {% else %}
      <div class="alert alert-info">
        Belum ada dokumen yang di-upload. Silakan upload PDF/TXT dulu.
      </div>
    {% endif %}
  </div>
</body>
</html>
